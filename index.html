<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CandyShop</title>
</head>
<body>
    <form onsubmit="addItem(event)">
        <h3>Candy Shop Seller Dashboard</h3>
        <label for="name">Candy Name</label>
        <input type="text" id="name" name="candyName">
        <label for="descrip">Description</label>
        <input type="text" id="descrip" name="description">
        <label for="price">Price</label>
        <input type="number" id="price" name="priced">
        <label for="quant">Quantity</label>
        <input type="number" id="quant" name="quanti">
        <input type="submit" value="ADD ITEM" style="font-weight: bold;">

    </form>
    <ul>

    </ul>
    <script>
        function addItem(event){
            event.preventDefault();
            let name = document.getElementById("name").value;
            let description = document.getElementById("descrip").value;
            let price = document.getElementById("price").value;
            let quantity = document.getElementById("quant").value;

            let obj = {
                CandyName : name,
                Description : description,
                Price : price,
                Quantity : quantity
            };

            localStorage.setItem(name,JSON.stringify(obj));
            axios.post("https://crudcrud.com/api/1af66eb2aef54fb9a85e3c5aa9962c89/CandyShopApp",obj)
            .then((res)=>{
                console.log(res);
            }).catch((error)=>{
                console.log(error);
            })
            

            showOnScreen(obj);
        }

        window.addEventListener("DOMContentLoaded",()=>{
            axios.get("https://crudcrud.com/api/1af66eb2aef54fb9a85e3c5aa9962c89/CandyShopApp")
            .then((res)=>{
                console.log(res);

                for(var i=0;i<res.data.length;i++){
                    showOnScreen(res.data[i]);
                }
            }).catch((error)=>{
                console.log(error)
            })
        });

        function showOnScreen(obj){
            let ul = document.querySelector("ul");
            let child = document.createElement("li");
            let textNode = document.createTextNode(`${obj.CandyName} --- ${obj.Description} --- ${obj.Price}---${obj.Quantity}`);

            let buy1Btn = document.createElement("input");
            buy1Btn.type = "button";
            buy1Btn.value = "BUY ONE";
            buy1Btn.style = "width : 70px"

            let buy2Btn = document.createElement("input");
            buy2Btn.type = "button";
            buy2Btn.value = "BUY TWO";
            buy2Btn.style = "width : 70px"

            let buy3Btn = document.createElement("input");
            buy3Btn.type = "button";
            buy3Btn.value = "BUY THREE";
            buy3Btn.style = "width : 80px"

            buy1Btn.addEventListener("click",()=>{
                 if(obj.Quantity > 0){
                    obj.Quantity = parseInt(obj.Quantity)-1;
                    textNode.textContent = (`${obj.CandyName} --- ${obj.Description} --- ${obj.Price}---${obj.Quantity}`);
                    localStorage.setItem(obj.CandyName,JSON.stringify(obj));
                    
                    axios.patch(`https://crudcrud.com/api/1af66eb2aef54fb9a85e3c5aa9962c89/CandyShopApp/${obj._id}`,{
                        Quantity : obj.Quantity
                    })
  .then(response => {
    console.log(response.data);
  })
  .catch(error => {
    console.error( error);
  });
                } else{
                    alert("Out Of Stock");
                }
            })



            buy2Btn.addEventListener("click",()=>{
                if(obj.Quantity > 0){
                    obj.Quantity = parseInt(obj.Quantity)-2;
                    textNode.textContent = (`${obj.CandyName} --- ${obj.Description} --- ${obj.Price}---${obj.Quantity}`);
                    localStorage.setItem(obj.CandyName,JSON.stringify(obj));
                } else{
                    alert("Out Of Stock");
                }
            })

            buy3Btn.addEventListener("click",()=>{
                if(obj.Quantity > 0){
                    obj.Quantity = parseInt(obj.Quantity)-3;
                    textNode.textContent = (`${obj.CandyName} --- ${obj.Description} --- ${obj.Price}---${obj.Quantity}`);
                    localStorage.setItem(obj.CandyName,JSON.stringify(obj));
                } else{
                    alert("Out Of Stock");
                }
            })

            
            child.appendChild(textNode);
            child.appendChild(buy1Btn);
            child.appendChild(buy2Btn);
            child.appendChild(buy3Btn);
            ul.appendChild(child);
        }


    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.5.0/axios.min.js"></script>
</body>
</html>